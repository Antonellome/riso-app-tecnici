â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    INTEGRAZIONE RISO APP
         Documento Completo per Sincronizzazione con RISO Master
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ CONTENUTO DEL DOCUMENTO

1. Panoramica Sistema
2. Credenziali Firebase
3. Struttura Dati UserConfig
4. Flusso di Attivazione
5. Storage Locale
6. Sincronizzazione Reports
7. Sistema Notifiche
8. Esempio Pratico Completo
9. Checklist Implementazione
10. Troubleshooting


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. PANORAMICA SISTEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RISO Master (applicazione principale)
  â†“ crea configurazione
  â†“ genera codice attivazione (es. ABC123XYZ)
  â†“ salva su Firebase: userConfigs/{CODICE_ATTIVAZIONE}
  
RISO App (applicazione tecnici)
  â†“ tecnico inserisce codice attivazione
  â†“ scarica configurazione da Firebase
  â†“ applica impostazioni automaticamente
  â†“ ascolta aggiornamenti real-time

Flusso di comunicazione:
- Firebase Firestore: Configurazioni e aggiornamenti real-time
- AsyncStorage Condiviso: @riso_sync_storage per dati locali


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2. CREDENZIALI FIREBASE (DEVONO ESSERE IDENTICHE!)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Entrambe le app DEVONO usare le stesse credenziali Firebase:

EXPO_PUBLIC_FIREBASE_API_KEY=AIzaSy...
EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=riso-app.firebaseapp.com
EXPO_PUBLIC_FIREBASE_PROJECT_ID=riso-app
EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=riso-app.appspot.com
EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456789
EXPO_PUBLIC_FIREBASE_APP_ID=1:123456789:web:abcdef


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
3. STRUTTURA DATI UserConfig (TypeScript Interface)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export interface UserConfig {
  // Identificazione
  userId: string;              // ID univoco del tecnico
  apiKey: string;              // API Key per autenticazione
  
  // Informazioni
  technicianName: string;      // Nome del tecnico
  companyName: string;         // Nome dell'azienda
  
  // Configurazione
  serverUrl: string;           // URL server sync
  autoSync: boolean;           // Sincronizzazione automatica
  active: boolean;             // Se il codice Ã¨ attivo
  
  // Timestamp
  createdAt: number;           // Timestamp creazione
  updatedAt?: number;          // Timestamp ultimo aggiornamento
  
  // Liste (opzionali)
  ships?: string[];            // Lista navi
  locations?: string[];        // Lista cantieri/location
  
  // Categorie tecnici (opzionali)
  technicianCategories?: {
    category: string;          // Nome categoria
    technicians: string[];     // Lista tecnici
  }[];
  
  // Configurazione lavoro (opzionale)
  work?: {
    defaultStartTime: string;     // "07:30"
    defaultEndTime: string;       // "16:30"
    defaultPauseMinutes: number;  // 60
    hourlyRates: {
      type: string;               // "Ordinaria", "Straordinaria", etc.
      rate: number;               // Tariffa oraria
    }[];
  };
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
4. FLUSSO DI ATTIVAZIONE (Step by Step)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LATO RISO MASTER:
----------------

Step 1: Creare la configurazione
const config: UserConfig = {
  userId: "TEC001",
  apiKey: "key_abc123xyz",
  technicianName: "Mario Rossi",
  companyName: "Riso S.r.l.",
  serverUrl: "https://sync.riso.com",
  autoSync: true,
  active: true,
  createdAt: Date.now(),
  ships: ["Nave Alpha", "Nave Beta"],
  locations: ["Cantiere A", "Cantiere B"],
  technicianCategories: [
    {
      category: "Elettricisti",
      technicians: ["Luigi Verdi", "Paolo Bianchi"]
    },
    {
      category: "Meccanici",
      technicians: ["Giovanni Neri", "Francesco Gialli"]
    }
  ],
  work: {
    defaultStartTime: "07:30",
    defaultEndTime: "16:30",
    defaultPauseMinutes: 60,
    hourlyRates: [
      { type: "Ordinaria", rate: 15 },
      { type: "Straordinaria", rate: 22.5 },
      { type: "Festiva", rate: 30 }
    ]
  }
};

Step 2: Generare codice attivazione (9 caratteri alfanumerici)
const activationCode = generateActivationCode(); // es. "ABC123XYZ"

Step 3: Salvare su Firebase
await saveConfigForCode(activationCode, config);

Step 4: Fornire il codice al tecnico
// Il tecnico riceverÃ : ABC123XYZ


LATO RISO APP (Tecnico):
------------------------

Step 1: Il tecnico avvia l'app per la prima volta

Step 2: Vede la schermata di attivazione

Step 3: Inserisce il codice: ABC123XYZ

Step 4: L'app:
  - Chiama Firebase per scaricare la configurazione
  - Applica automaticamente tutte le impostazioni
  - Salva il codice per aggiornamenti futuri
  - Attiva il listener real-time per modifiche

Step 5: L'app Ã¨ configurata e pronta all'uso!


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
5. STORAGE LOCALE (Chiavi AsyncStorage)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Chiavi usate da RISO App:

@riso_app_settings              â†’ Impostazioni app
@riso_app_reports               â†’ Reports salvati
@riso_app_password              â†’ Password protezione app
@riso_app_notifications         â†’ Notifiche
@riso_app_recent_technicians    â†’ Tecnici usati di recente
@riso_app_activation_code       â†’ Codice attivazione
@riso_app_is_activated          â†’ Flag attivazione

Chiavi condivise (MockSyncServer):

@riso_sync_server_users         â†’ Utenti registrati
@riso_sync_server_reports       â†’ Reports sincronizzati
@riso_sync_server_notifications â†’ Notifiche server
@riso_sync_server_technicians   â†’ Lista tecnici
@riso_sync_server_ships         â†’ Lista navi
@riso_sync_server_locations     â†’ Lista cantieri


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
6. SINCRONIZZAZIONE REPORTS (API MockSyncServer)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Report Structure:
{
  id: string;
  userId: string;
  date: string;                // "2025-01-15"
  shiftType: string;           // "Ordinaria", "Straordinaria", etc.
  startTime: string;           // "07:30"
  endTime: string;             // "16:30"
  pauseMinutes: number;        // 60
  ship: string;                // "Nave Alpha"
  location: string;            // "Cantiere A"
  description: string;
  materials: string;
  workDone: string;
  technicians: {
    id: string;
    name: string;
    startTime: string;
    endTime: string;
  }[];
  createdAt: number;
  updatedAt: number;
}

API Methods disponibili:

// Sincronizzare reports verso server
await MockSyncServer.syncUserData(userId, apiKey, reports);

// Scaricare reports da server
await MockSyncServer.getUserData(userId, apiKey);

// Ottenere lista navi e cantieri
await MockSyncServer.getShipsAndLocations();

// Ottenere tecnici categorizzati
await MockSyncServer.getTechnicians();

// Ottenere notifiche utente
await MockSyncServer.getUserNotifications(userId, apiKey);


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
7. SISTEMA NOTIFICHE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Notification Structure:
{
  id: string;
  title: string;
  message: string;
  date: string;
  timestamp: number;
  priority: 'low' | 'normal' | 'high';
  type: 'info' | 'warning' | 'alert' | 'config';
  targetUsers: string[];       // ['all'] o ['TEC001', 'TEC002']
  createdBy: string;
  configData?: SyncConfigData; // Per notifiche tipo 'config'
}

RISO Master puÃ² inviare notifiche a:
- Tutti i tecnici: targetUsers: ['all']
- Tecnici specifici: targetUsers: ['TEC001', 'TEC002']

Esempio invio notifica:
await MockSyncServer.addNotification({
  id: Date.now().toString(),
  title: "Aggiornamento Tariffe",
  message: "Le tariffe orarie sono state aggiornate.",
  date: new Date().toISOString().split('T')[0],
  timestamp: Date.now(),
  priority: 'high',
  type: 'info',
  targetUsers: ['all'],
  createdBy: 'MASTER'
});


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
8. ESEMPIO PRATICO COMPLETO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SCENARIO: Aggiungere un nuovo tecnico e notificare l'app

RISO MASTER:
-----------

// 1. Creare configurazione iniziale (solo prima volta)
const config: UserConfig = {
  userId: "TEC001",
  apiKey: "key_mario_rossi",
  technicianName: "Mario Rossi",
  companyName: "Riso S.r.l.",
  serverUrl: "https://sync.riso.com",
  autoSync: true,
  active: true,
  createdAt: Date.now(),
  ships: ["Nave Alpha"],
  locations: ["Cantiere A"],
  technicianCategories: [{
    category: "Elettricisti",
    technicians: ["Luigi Verdi"]
  }],
  work: {
    defaultStartTime: "07:30",
    defaultEndTime: "16:30",
    defaultPauseMinutes: 60,
    hourlyRates: [
      { type: "Ordinaria", rate: 15 }
    ]
  }
};

// 2. Generare codice e salvare
const code = "ABC123XYZ";
await saveConfigForCode(code, config);

// 3. Fornire codice a Mario Rossi
console.log("Codice attivazione per Mario Rossi:", code);

// ... Dopo qualche giorno, aggiungiamo un nuovo tecnico ...

// 4. Aggiornare la configurazione
config.technicianCategories[0].technicians.push("Paolo Bianchi");
config.updatedAt = Date.now();
await saveConfigForCode(code, config);

// 5. L'app di Mario riceverÃ  automaticamente l'aggiornamento!


RISO APP (Mario Rossi):
----------------------

// 1. Prima attivazione
await activateWithCode("ABC123XYZ");

// L'app scarica e applica automaticamente:
// - Nome: Mario Rossi
// - Azienda: Riso S.r.l.
// - Navi: ["Nave Alpha"]
// - Cantieri: ["Cantiere A"]
// - Tecnici: ["Luigi Verdi"]
// - Tariffe: Ordinaria 15â‚¬/h

// 2. Dopo l'aggiornamento da RISO Master
// Il listener real-time rileva la modifica e aggiorna:
// - Tecnici: ["Luigi Verdi", "Paolo Bianchi"]

// 3. Mario puÃ² ora selezionare Paolo Bianchi nei report!


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
9. CHECKLIST IMPLEMENTAZIONE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RISO APP (âœ“ COMPLETATO):
------------------------
âœ“ Firebase integration (utils/firebase.ts)
âœ“ UserConfig interface
âœ“ getConfigByCode() function
âœ“ subscribeToConfigUpdates() function
âœ“ Activation screen (components/ActivationCodeScreen.tsx)
âœ“ activateWithCode() in AppContext
âœ“ skipActivation() fallback
âœ“ Real-time config listener
âœ“ Automatic config application
âœ“ Storage keys defined


RISO MASTER (DA IMPLEMENTARE):
------------------------------
â˜ Installare Firebase SDK
â˜ Aggiungere credenziali Firebase (identiche a RISO App!)
â˜ Creare utils/firebase.ts con:
    - initializeFirebase()
    - saveConfigForCode()
    - subscribeToConfigUpdates() (opzionale)
â˜ Creare interface UserConfig (copiare da RISO App)
â˜ UI per creare nuove configurazioni
â˜ UI per generare codici attivazione
â˜ UI per gestire tecnici esistenti
â˜ UI per visualizzare app attive
â˜ UI per disattivare/riattivare codici
â˜ Sistema per inviare notifiche


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
10. TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ï¿½ï¿½â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Problema: "Codice non valido o non trovato"
Soluzione:
- Verificare che il codice sia esattamente quello salvato su Firebase
- Controllare che il documento esista in userConfigs/{CODICE}
- Verificare le credenziali Firebase in entrambe le app

Problema: "Questo codice Ã¨ stato disattivato"
Soluzione:
- Il campo "active" Ã¨ false
- Riattivare da RISO Master impostando active: true

Problema: "L'app non riceve aggiornamenti"
Soluzione:
- Verificare che il listener sia attivo
- Controllare i log: "[AppContext] Firebase config updated"
- Riavviare l'app per riattivare il listener

Problema: "Credenziali Firebase non funzionano"
Soluzione:
- DEVONO essere identiche in entrambe le app
- Controllare EXPO_PUBLIC_FIREBASE_* in .env
- Verificare che il progetto Firebase sia configurato

Problema: "Reports non si sincronizzano"
Soluzione:
- Verificare sync.enabled = true nelle impostazioni
- Controllare userId e apiKey
- Verificare che l'utente sia registrato nel MockSyncServer


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         FINE DOCUMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Per domande o supporto, consultare:
- FIREBASE_SETUP.md per setup Firebase
- contexts/AppContext.tsx per logica attivazione
- utils/firebase.ts per funzioni Firebase
- utils/mockSyncServer.ts per API sync

Il documento Ã¨ pronto per essere condiviso con il team RISO Master! ğŸš€
